{% extends "base.html" %}
{% block title %}Vote{% endblock %}
{% block content %}
<main class="p-6 space-y-6 bg-gray-100 min-h-screen">
    <!-- Election Voting Header -->
    <div class="text-2xl font-bold text-dark-green">Vote in Election</div>

    <!-- Voting Form -->
    <section class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Select an Election and Vote</h3>

        <!-- Form to vote in an election -->
        <form method="POST" action="{% url 'submit-vote' %}" class="space-y-4" id="vote-form">
            {% csrf_token %}
            
            <!-- Dropdown to select election -->
            <div>
                <label for="election" class="block text-sm font-medium">Select Election</label>
                <select name="election_id" id="election" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg" required>
                    <option value="" disabled selected>Select an election</option>
                    {% for poll in polls %}
                        <option value="{{ poll.id }}">{{ poll.title }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Dropdown to select candidate -->
            <div id="candidates-container" class="hidden">
                <label for="candidate" class="block text-sm font-medium">Select Candidate</label>
                <select name="candidate_id" id="candidate" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg" required>
                    <!-- Candidates will be loaded here dynamically via JS -->
                </select>
            </div>

            <!-- Submit Vote Button -->
            <button type="submit" class="w-full md:w-auto bg-dark-green text-white px-6 py-2 rounded-lg">Submit Vote</button>
        </form>

        <!-- Success Message -->
        <div id="success-message" class="hidden text-green-500 text-sm font-semibold mt-4"></div>
    </section>
</main>

<script>
document.getElementById('election').addEventListener('change', function() {
    var electionId = this.value;

    // Fetch candidates for selected election
    fetch(`/api/elections/${electionId}/candidates/`)
        .then(response => response.json())
        .then(data => {
            var candidateSelect = document.getElementById('candidate');
            candidateSelect.innerHTML = '';  // Clear existing candidates
            data.candidates.forEach(candidate => {
                var option = document.createElement('option');
                option.value = candidate.id;
                option.textContent = candidate.option_text;
                candidateSelect.appendChild(option);
            });
            document.getElementById('candidates-container').classList.remove('hidden');
        });
});
</script>
{% endblock %}
